<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch List - Oxlâ˜°yrd</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-default.min.css">

    <script src="https://widgets.coingecko.com/coingecko-coin-list-widget.js"></script>
    <style>
        .w-hole {
            display: table-row
        }

        .w-section {
            padding: 10px;
            min-width: 300px;
        }
    </style>
    <script>
        var collection = [
            {
                type: "seigniorage",
                list: "chargedefi-charge,chargedefi-static,hermes,harmes-shares"
            },
            {
                type: "farm",
                list: "looksrare,liquiddriver,spiritswap,protofi"
            },

            {
                type: "node",
                list: "strong,vapornodes,louverture,thor,project-x-nodes"
            },
            {
                type: "hodl",
                list: "bitcoin,ethereum,avalanche-2,fantom,ripple,cardano,polkadot,efinity"

            }, {
                type: "masternode",
                list: "dash-diamond",
            }];

        var state = "M"; // multiple list
        var toggleLabel = "Single List";

        function _onload() {
            document.getElementById("reloadbutton").addEventListener("click", () => reload());


            document.getElementById("singlebutton").addEventListener("click", (e) => {
                toggle();
                e.target.textContent = toggleLabel;
            });

            var s = localStorage.getItem("state");
            if (s) { state = s; if (state == "S") { toggleLabel = "Multiple List" } }
            document.getElementById("singlebutton").textContent = toggleLabel;
            reload();
        }

        function reload() {
            state == "M" ? loadMultipleList() : loadSingleList();
        }

        function toggle() {
            if (state == "M") {
                state = "S";
                loadSingleList();
                toggleLabel = "Multiple List";
            } else {
                state = "M";
                loadMultipleList();
                toggleLabel = "Single List"
            }
            localStorage.setItem("state", state);
        }

        function clearContainer() {
            var container = document.getElementById("container");
            while (container.firstChild) {
                container.removeChild(container.lastChild);
            }
        }

        function loadSingleList() {
            clearContainer();

            var list = collection.map(i => i.list).join();
            createWatchList({ list: list });
        }

        function loadMultipleList() {
            clearContainer();

            collection.forEach((item) => createWatchList(item));
        }

        function createWatchList(item) {
            var hole = document.getElementById("container");
            hole.appendChild(createListWidget(item));
        }

        function createListWidget(item) {
            var wrapper = document.createElement("div");
            wrapper.className = "col-sm w-section";

            // example:
            //     <coingecko-coin-list-widget id="listwidget" coin-ids="bitcoin" currency="usd" locale="en">
            //     </coingecko-coin-list-widget>
            if (item.type) {
                var h = document.createElement("h2");
                h.textContent = item.type;
                console.log(h);
                wrapper.appendChild(h);
            }

            var w = document.createElement("coingecko-coin-list-widget");
            if (item.type) { w.id = item.type; }
            w.setAttribute("currency", "usd");
            w.setAttribute("locale", "en");
            w.setAttribute("coin-ids", item.list);

            console.log(w);
            wrapper.appendChild(w);

            return wrapper;
        }
    </script>
</head>

<body onload="_onload()">
    <h1>Watch List</h1>

    <button class="primary" id="reloadbutton">Reload</button>
    <button class="shadowed" id="singlebutton">Single List</button>
    <div class="container">
        <div class="row" id="container"></div>
    </div>


</body>

</html>